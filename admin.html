<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Kazz Second Branded</title>
  <link rel="stylesheet" href="style.css">
</head>
<body style="padding:30px">

<h2>Login Admin</h2>
<input id="email" type="email" placeholder="Email admin"><br><br>
<input id="pass" type="password" placeholder="Password"><br><br>
<button type="button" onclick="login()">Login</button>

<hr>

<h2>Tambah Produk</h2>
<input id="name" placeholder="Nama Produk"><br><br>
<input id="price" type="number" placeholder="Harga"><br><br>
<input id="stock" type="number" placeholder="Stok"><br><br>
<input type="file" id="img"><br><br>
<button type="button" onclick="upload()">Upload Produk</button>

<hr>

<h2>Dashboard Stok</h2>
<table>
<thead>
<tr>
  <th>Produk</th>
  <th>Harga</th>
  <th>Stok</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<!-- ================= FIREBASE SDK ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- ================= FIREBASE CONFIG ================= -->
<script src="firebase.js"></script>

<!-- ================= ADMIN SCRIPT ================= -->
<script>
console.log("ADMIN JS JALAN");

const IMGBB_KEY = "450fadf17da34b9423ba7a95051103f9";

function login(){
  auth.signInWithEmailAndPassword(
    document.getElementById("email").value,
    document.getElementById("pass").value
  )
  .then(() => alert("Login berhasil"))
  .catch(err => alert(err.message));
}

function upload(){
  if(!auth.currentUser){
    alert("Login dulu");
    return;
  }

  const file = img.files[0];
  if(!file){
    alert("Pilih gambar");
    return;
  }

  const form = new FormData();
  form.append("image", file);

  fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{
    method:"POST",
    body:form
  })
  .then(res => res.json())
  .then(data => {
    db.collection("products").add({
      name: name.value,
      price: Number(price.value),
      stock: Number(stock.value),
      img: data.data.url
    });
    alert("Produk ditambahkan");
  });
}

const tbody = document.getElementById("table");

db.collection("products").onSnapshot(snapshot=>{
  tbody.innerHTML = "";
  snapshot.forEach(doc=>{
    const p = doc.data();
    tbody.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>Rp ${p.price}</td>
        <td>${p.stock}</td>
        <td>
          <button onclick="update('${doc.id}',1)">+</button>
          <button onclick="update('${doc.id}',-1)">âˆ’</button>
          <button onclick="del('${doc.id}')">ðŸ—‘</button>
        </td>
      </tr>
    `;
  });
});

function update(id,val){
  db.collection("products").doc(id)
    .update({stock: firebase.firestore.FieldValue.increment(val)});
}

function del(id){
  if(confirm("Hapus produk?")){
    db.collection("products").doc(id).delete();
  }
}
</script>

</body>
</html>
